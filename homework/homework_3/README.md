# 第一单元第三次作业

## 摘要

本次作业，需要完成的任务为**包含简单幂函数和简单正余弦函数的导函数**的求解。

## 问题

### 设定

首先是一些基本概念的声明：

- **带符号整数 **支持前导 0 的带符号整数，符号可忽略，如：`+02`、`-16`、`19260817` 等。
- **因子** 
  - **变量因子** 
    - **幂函数** 
      - **一般形式** 由自变量x和指数组成，指数为一个带符号整数，如：`x ^ +2`。**且，指数绝对值一律不得超过$ {10}^4 $**。
      - **省略形式** 当指数为1的时候，可以采用省略形式，如：`x`。
    - **三角函数** `sin(x)`，`cos(x)`，另外，本指导书范围内**所有的词语“三角函数”，除非特殊说明，否则一律包含且仅包含上述两个函数**）
      - **一般形式** 类似于幂函数，由`sin(x)`，`cos(x)` 和指数组成，指数为一个带符号整数，如：`sin(x) ^ +2`。**同样的，指数绝对值一律不得超过${10}^{4}$**。
      - **省略形式** 当指数为1的时候，可以采用省略形式，省略指数部分，如：`sin(x)`。
  - **常数因子** 包含一个带符号整数，如：`233`。
  - **表达式因子** 将在表达式的相关设定中进行详细介绍。不过，**<u>表达式因子不支持幂运算</u>**。
  - **嵌套因子** 本次作业将支持**因子嵌套在三角函数因子里面**，即一个因子作为另一个三角函数因子的自变量，例如```sin(x^2)```，```cos(sin(x))``` 以及 ```sin(sin(cos(cos(x^2))))^2``` 等。但是**不允许出现指数为变量的情况，指数依然只能是带符号整数**，例如**```sin(x) ^ sin(x)```是不合法的**，因为**指数不是自变量**。也**不允许幂函数的自变量为除了```x```之外的因子**，例如**```1926^0817```是不合法的，因为幂函数的自变量只能为```x```**。
- **项**
  - **一般形式**由乘法运算符连接若干任意因子组成，如：`x * cos(x) * x`，`sin(x ^ 2) * cos(sin(x)) ^ 2 * x ^ -2` 等。
    - **项内因子不仅仅是同类因子**
  - **特殊形式**
    - 第一个因子为常数因子 1 且**其后跟着乘号**的时候，可以省略该常数因子或表示为正号开头的形式，如：`x ^ 2 * x ^ -1`、 `+ x ^ 2`、`+ cos(x) * cos(x)`、 `sin(x) * cos(x)`。
    - 第一个因子为常数因子 -1 且**其后跟着乘号**的时候，可以表示为负号开头的形式，如：`-x ^ 2、- cos(x) * sin(x)`。
- **表达式** 由加法和减法运算符等若干项组成，如： `(-1 + x ^ 233)* sin(x^2) ^ 06 - cos(sin(x)) * 3 * sin((x))`。此外，**在第一项之前，可以带一个正号或者负号**，如：`- -1 + x ^ 233、+ -2 + x ^ 1926`。此处有几点注意：
  - **表达式因子**，表达式可以作为因子，其定义为被一对小括号包裹起来的表达式，即我们允许诸如`(x * cos(x))` 这种式子的出现
  - **空串不属于合法的表达式**
- **空白字符** 在本次作业中，空白字符包含且仅包含`<space>`和`\t`。其他的除了上述会用到的字符之外，均属于非法字符。

此外，值得注意的几点是：

- 带符号整数内不允许包含空白字符。
- 三角函数的保留字内不允许包含空白字符，即`sin`，`cos`  关键字内不可以含有空白字符。
- 因子、项、表达式，在不与上两条矛盾的前提下，可以在任意位置包含任意数量的空白字符。
- 表达式因子可以递归嵌套，例如`sin( ( x^2 + sin((1 + 3*x)) ) )`
- 如果某表达式存在不同的解释方式，则只要有任意一条解释中是合法的，该表达式即为合法。
- 为了方便评测机评测，**我们限制的指数的绝对值不超过$10^4$，超过此范围需要输出 `WRONG FORMAT!` **
- **（重大更新）** 对于类似`sin((x-x))^-1`的输入，会存在除0的情况，对于评测是非常难处理的，故对指导书进行补充。为了保证向下兼容，我们限制所有的指数必须大于等于0，这一条作为基本限制，任何测试数据不得违背该限制，不需要对此输出`WRONG FORMAT!`

## 样例

|  #   | 输入                         | 输出                                               | 解释                                                       |
| :--: | ---------------------------- | -------------------------------------------------- | ---------------------------------------------------------- |
|  1   | 1                            | 0                                                  | 显然。                                                     |
|  2   | 4*x+x^2+x+1                  | 2*x+5                                              | 幂函数与常量因子为同类因子                                 |
|  3   | 4*x+x^2+x                    | 4+2*x+1                                            | 未合并同类项，但表达式依然等价。                           |
|  4   | 4x+x^2+x                     | WRONG FORMAT!                                      | 4x不是合法项，应该写作4*x                                  |
|  5   | - -4*x + x ^ 2 + x           | 2*x+5                                              | -4x为合法项，且表达式第一项前也可以包含正负号。            |
|  6   | +4*x - -x^2 + x              | 2*x+5                                              | -x^2为合法项。                                             |
|  7   | +19260817*x                  | 19260817                                           | 显然。                                                     |
|  8   | + 19260817*x                 | 19260817                                           | 多项式第一项前可以带有正负号。                             |
|  9   | +++ 19260817*x               | WRONG FORMAT!                                      | 项内有符号整数不可以包含空白字符。                         |
|  10  | +++1                         | 0                                                  | 合法，实际上三个加号分别对应的是表达式、项、带符号整数。   |
|  11  | +++x                         | WRONG FORMAT!                                      | 不合法，用现有文法无法正确解释。                           |
|  12  | ++++1                        | WRONG FORMAT!                                      | 因子里头只能省略第一个，且必须在包含多个因子时才可以省略。 |
|  13  | +++++++                      | WRONG FORMAT!                                      | 显然啊，不要想着全部省略这种奇怪的东西啦。                 |
|  14  | 1926 0817 * x                | WRONG FORMAT!                                      | 同上。                                                     |
|  15  | (空)                         | WRONG FORMAT!                                      | 空串不属于合法表达式。                                     |
|  16  | 2*sin(x)                     | 2*cos(x)                                           | 常数因子与三角函数相乘                                     |
|  18  | -1*cos(x)                    | sin(x)                                             | 同上                                                       |
|  18  | 23+sin(x)*3                  | 3*cos(x)                                           | 同上                                                       |
|  19  | cos(x)* sin(x)* 5+4 *x^3     | -5* sin(x)^2 + 5* cos(x) * cos(x)+12* x^2          | 显然                                                       |
|  20  | 43+4*x^3                     | 12*x^2                                             | 仅包括常数因子项加包括幂函数的同类因子项                   |
|  21  | 6*si n(x)                    | WRONG FORMAT!                                      | 'sin'间不能有空白字符                                      |
|  22  | 6*co s(x)                    | WRONG FORMAT!                                      | 'cos'间不能有空白字符                                      |
|  23  | 6*arctan(x)                  | WRONG FORMAT!                                      | 无法识别的函数名(arctan已经取消了)                         |
|  24  | 1*x^2                        | 2*x                                                | 显然                                                       |
|  25  | sin(cos(x))                  | -cos(cos(x))* sin(x)                               | 三角函数作为三角函数因子                                   |
|  26  | sin((2 * x)) * (cos(x)+1)    | 2\*(cos(x) + 1)\*cos((2\*x)) - sin(x)\*sin((2\*x)) | 显然                                                       |
|  27  | sin((2 * x )) * (cos(x)+1)^2 | WRONG FORMAT!                                      | 表达式因子不得带有幂运算                                   |
|  28  | sin (x)                      | cos(x)                                             | 显然                                                       |
|  29  | sin ( x )                    | cos(x)                                             | 还是显然                                                   |
|  30  | sin(x)^10000                 | 10000\*cos(x)\*sin(x)^9999                         | 显然                                                       |
|  31  | sin(x)^10001                 | WRONG FORMAT!                                      | 指数绝对值一概不得超过${10}^4$                             |
|  32  | sin(2*x)                     | WRONG FORMAT!                                      | '2*x'不是因子                                              |
|  33  | 1926^0817                    | WRONG FORMAT!                                      | 幂函数的自变量只能为x                                      |

## 提示

- Java内的原生整数类型有`long`和`int`，长度分别为64位和32位。
- 如果觉得上述数据类型不够用的话，可以百度一下Java内可以怎样快速处理这个问题。
- 在Java内，不建议使用静态数组。推荐使用`ArrayList`、`HashMap`、`HashSet`一类的数据结构，快速管理和调配手中无序的数据。
- 关于输入字符串的处理，推荐使用**正则表达式**。
- 这次作业，看上去似乎很难，其实找对了方法后并不难。关键思想是，**化整为零**，可以这样考虑
  - 对于每一种函数（常数、幂函数、三角函数），建立类
  - 对于每一种函数组合规则（乘法、加减法、嵌套），建立类
  - 对于上述的两种类，均实现一个求导接口
    - 其中，第一种类，做法显而易见
    - 其中，第二种类，做法一样显而易见
  - 通过上述两种类及其求导接口，把整个表达式构建为树结构，**也就是讨论区大佬们说的，链式求导**
- 对于秒掉正确性部分后，想要最大限度优化性能的<del>大佬</del>同学，一样可以将上述的化整为零思想作为可行思路之一，设计算法。